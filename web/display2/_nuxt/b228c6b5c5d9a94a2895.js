(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{214:function(e,t,r){var content=r(222);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(83).default)("35cce301",content,!0,{sourceMap:!1})},215:function(e,t,r){var content=r(225);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(83).default)("1147586a",content,!0,{sourceMap:!1})},216:function(e,t,r){var content=r(227);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(83).default)("0ace817b",content,!0,{sourceMap:!1})},221:function(e,t,r){"use strict";var o=r(214);r.n(o).a},222:function(e,t,r){(t=r(82)(!1)).push([e.i,".bar-gauge{display:grid;grid-template-columns:1fr;grid-template-rows:1fr -webkit-max-content;grid-template-rows:1fr max-content;grid-gap:5px;gap:5px;padding:10px 0;position:relative;box-sizing:border-box}.bar-gauge,.frame{border-radius:2.125rem}.frame{position:absolute;width:100%;height:100%;z-index:1000;display:none;box-sizing:border-box;pointer-events:none}.zero-line{position:absolute;left:-2.5px;right:-2.5px;height:1px;background-color:#5e5e5e;transform:translateY(-50%)}.track{background-color:#474747;position:relative}.bar{position:absolute;background-color:#fff}.bar-chart{position:relative}.bar-watt{position:absolute;top:0;bottom:0;left:50%;transform:translate(-50%);width:2.375rem}.vertical{position:absolute;width:2rem;right:0}.axis.color-green{background-color:#179e58}.axis.color-yellow{background-color:#b2b00c}.axis.color-red{background-color:#a51e00}.axis.color-purple{background-color:#aa00a5}.axis.color-white{background-color:#b9b9b9}.bar-gauge.selectable.selected .bar.color-green,.bar-gauge.selectable.selected:active .bar.color-green,.bar.color-green{background-color:#24db7c}.bar-gauge.selectable.selected .bar.color-yellow,.bar-gauge.selectable.selected:active .bar.color-yellow,.bar.color-yellow{background-color:#ebe914}.bar-gauge.selectable.selected .bar.color-red,.bar-gauge.selectable.selected:active .bar.color-red,.bar.color-red{background-color:#ff3500}.bar-gauge.selectable.selected .bar.color-purple,.bar-gauge.selectable.selected:active .bar.color-purple,.bar.color-purple{background-color:#ff00f8}.bar-gauge.selectable.selected .bar.color-white,.bar-gauge.selectable.selected:active .bar.color-white,.bar.color-white{background-color:#f1f1f1}.color-green{color:#24db7c}.color-yellow{color:#ebe914}.color-red{color:#ff3500}.color-purple{color:#ff00f8}.color-white{color:#fff}.axis.vertical{width:.25rem;left:0;right:auto}.description-area{display:grid;grid-gap:5px;gap:5px;grid-auto-flow:row dense;justify-items:center}.value-area{text-align:center}.big-value{display:inline-block;font-size:2rem;line-height:1em;position:relative}.big-value .space-measure{visibility:hidden}.big-value .display-value{position:absolute;right:0;top:0}.value-label{height:1.1em}.soc-area{width:100%;text-align:center;padding-top:5px}.track.tiny-horizontal{height:.25rem;margin:0 .4375rem}.track.tiny-horizontal .bar{height:100%}.bar-gauge.selectable{background-color:#001e2f;color:#b2d8ff}.bar-gauge.selectable .frame{border:2px solid #007db5;display:block}.bar-gauge.selectable .track{background-color:#000}.bar-gauge.selectable .bar{background-color:#b2d8ff}.bar-gauge.selectable:not(.selected) .axis.color-green,.bar-gauge.selectable:not(.selected) .axis.color-purple,.bar-gauge.selectable:not(.selected) .axis.color-red,.bar-gauge.selectable:not(.selected) .axis.color-white,.bar-gauge.selectable:not(.selected) .axis.color-yellow,.bar-gauge.selectable:not(.selected) .bar.vertical{background-color:#474747}.bar-gauge.selectable:not(.selected) .color-green,.bar-gauge.selectable:not(.selected) .color-purple,.bar-gauge.selectable:not(.selected) .color-red,.bar-gauge.selectable:not(.selected) .color-white,.bar-gauge.selectable:not(.selected) .color-yellow{color:#767676}.bar-gauge.selectable:active{background-color:#00344e;color:#cde5ff}.bar-gauge.selectable:active .frame{border:2px solid #09d}.bar-gauge.selectable:active .bar{background-color:#cde5ff}.bar-gauge.selectable.selected{background-color:#3b3b3b;color:#fff}.bar-gauge.selectable.selected .frame{border:2px solid #fff}.bar-gauge.selectable.selected .bar{background-color:#fff}.bar-gauge.selectable.selected:active{background-color:#00293f;color:#cde5ff}.bar-gauge.selectable.selected:active .frame{border:2px solid #cde5ff}.bar-gauge.selectable.selected:active .bar{background-color:#cde5ff}",""]),e.exports=t},224:function(e,t,r){"use strict";var o=r(215);r.n(o).a},225:function(e,t,r){(t=r(82)(!1)).push([e.i,".chart-area{display:grid;grid-gap:5px;gap:5px;grid-auto-flow:column dense;grid-auto-columns:1fr}",""]),e.exports=t},226:function(e,t,r){"use strict";var o=r(216);r.n(o).a},227:function(e,t,r){(t=r(82)(!1)).push([e.i,"button{background-color:#007db5;color:#fff;font-weight:400;font-size:1.5rem;height:4.25rem;border:none;box-sizing:border-box;border-radius:2.125rem;line-height:1.1em}button:active{background-color:#09d}button.selected{background-color:#fff;color:#007db5}button.selected:active{background-color:#cde5ff;color:#006492}.error button{background-color:#e12f00;color:#fff}.error button:active{background-color:#ff5542}.error button.selected{background-color:#fff;color:#e12f00}.error button.selected:active{background-color:#ffdad8;color:#b62400}.container{position:fixed;grid-template-columns:1fr;grid-template-rows:1fr -webkit-max-content;grid-template-rows:1fr max-content;width:100%;height:100%}.buttonbar,.container{display:grid;grid-gap:5px;gap:5px}.buttonbar{grid-auto-flow:column dense;grid-auto-columns:1fr}.buttonbar>:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.buttonbar>:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}",""]),e.exports=t},229:function(e,t,r){"use strict";r.r(t);r(20);var o=r(4),n=r(17),l=(r(25),r(13),r(149),r(37)),c=(r(217),r(230)),d=r(220),f=r.n(d),m=r(1);function h(e,t){return{topic:e,defaultValue:t,transform:function(e){return e}}}function v(e,t){console.log("mqtt",e,t);var r=new f.a.Client(e,t,Object(c.a)()),o=[],d={};function v(e,t,r){if(t)if(Array.isArray(t))for(var i=0;i<t.length;++i)r(i,t[i]);else if("object"===Object(l.a)(t))for(var o=0,c=Object.entries(t);o<c.length;o++){var d=Object(n.a)(c[o],2);r(d[0],d[1])}}function x(e,data,t){v(0,e,(function(e,o){var n=o;switch(Object(l.a)(o)){case"string":n=t(o);case"function":var c=n(),f=c.topic,h=c.transform;!function(e,t){d[e]&&console.warn("Overriding topic",e),t?(d[e]=t,r.subscribe(e)):(delete d[e],r.unsubscribe(t))}(f,(function(t){return m.a.set(data,e,h(t))}));break;default:x(o,data[e],t)}}))}function y(e,t){v(0,t,(function(t,r){if("string"!=typeof r)if("function"!=typeof r)e[t]=e[t]||(Array.isArray(r)?[]:{}),y(e[t],r);else{var o=r().defaultValue;void 0!==o&&(e[t]=o)}}))}function w(){if(r.isConnected())for(;o.length;){var e=o.shift();x(e.subscriptionMap,e.data,e.defaultConfig)}}return r.onConnectionLost=function(e){console.error("MQTT connection lost",e)},r.onMessageArrived=function(e){console.log("in",e.destinationName,e.payloadString);try{d[e.destinationName](e.payloadString)}catch(e){console.log(e)}},r.connect({onSuccess:function(){console.log("MQTT connected"),w()}}),{methods:{$mqttRegisterSubscriptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,data={};return y(data,e),o.push({subscriptionMap:e,data:data,defaultConfig:t}),w(),data},$mqttSendMessage:function(e,t){var o=new f.a.Message("".concat(t));o.destinationName=e,console.log("out",e,t),r.send(o)}},destroyed:function(){r.disconnect()}}}v.String=h,v.Boolean=function(e,t){return function(){return{topic:e,defaultValue:t,transform:function(e){return!!Number(e)}}}},v.Number=function(e,t){return function(){return{topic:e,defaultValue:t,transform:function(e){return Number(e)}}}};var x=v,y={props:{name:String,value:Number,minValue:Number,maxValue:Number,negativLabel:String,positivLabel:String,zeroLabel:String,labelOverride:String,ranges:Object,selectable:{type:Boolean,default:!1},selected:Boolean,showAmps:{type:Boolean,default:!1},ampValue:Number,showSoc:{type:Boolean,default:!1},soc:Number},inject:["limits","setUpperLimit","setLowerLimit"],watch:{minValue:{immediate:!0,handler:function(e){this.setLowerLimit(this,e)}},maxValue:{immediate:!0,handler:function(e){this.setUpperLimit(this,e)}}},computed:{displayValue:function(){return Math.abs(this.value||0)},label:function(){return this.labelOverride||(this.value<0?this.negativLabel:this.value>0?this.positivLabel:this.zeroLabel||"")},socStyle:function(){return{visibility:this.showSoc?"visible":"hidden"}},socBarStyle:function(){return{width:"".concat(this.soc,"%")}},zeroLineStyle:function(){return{top:this.tp(0)}},valueColorName:function(){var e=this.selectable&&!this.selected?"white":"";if(this.ranges)for(var t=0,r=Object.entries(this.ranges);t<r.length;t++){var o=Object(n.a)(r[t],2),l=o[0],c=o[1],d=this.percentToNumber(c);if(d*this.value>0&&Math.abs(this.value)<=Math.abs(d)){if(e&&Math.abs(this.ranges[e])<Math.abs(d))continue;e=l}}return e}},methods:{bm:function(e){return"".concat((e-this.limits.lower)/this.limits.distance*100,"%")},tp:function(e){return"".concat((this.limits.upper-e)/this.limits.distance*100,"%")},getBarStyle:function(e,t){if(t<e){var r=[t,e];e=r[0],t=r[1]}return{top:this.tp(t),bottom:this.bm(e)}},getAxisStyle:function(e,t){if(t<e){var r=[t,e];e=r[0],t=r[1]}return{top:this.tp(this.percentToNumber(t)),bottom:this.bm(this.percentToNumber(e)),zIndex:100-Math.abs(t||e)}},percentToNumber:function(e){return e<0?-e/100*this.minValue:e/100*this.maxValue}}},w=(r(221),r(47)),k=Object(w.a)(y,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"bar-gauge",class:{selectable:e.selectable,selected:e.selected},on:{click:function(t){return e.$emit("click")}}},[r("div",{staticClass:"bar-chart"},[r("div",{staticClass:"bar-watt"},[e._l(e.ranges,(function(t,o){return r("div",{key:o,staticClass:"axis vertical",class:"color-"+o,style:e.getAxisStyle(0,t)})})),e._v(" "),r("div",{staticClass:"track vertical",style:e.getBarStyle(e.minValue,e.maxValue)}),e._v(" "),r("div",{staticClass:"bar vertical",class:"color-"+e.valueColorName,style:e.getBarStyle(0,e.value)})],2),e._v(" "),r("div",{staticClass:"zero-line",style:e.zeroLineStyle})]),e._v(" "),r("div",{staticClass:"description-area"},[r("div",[e._v(e._s(e.name))]),e._v(" "),r("div",{staticClass:"value-area",class:"color-"+e.valueColorName},[r("div",{staticClass:"big-value"},[r("div",{staticClass:"space-measure"},[e._v("99 999")]),e._v(" "),r("i18n-n",{staticClass:"display-value",attrs:{value:e.displayValue},scopedSlots:e._u([{key:"group",fn:function(){return[e._v(" ")]},proxy:!0}])})],1),e._v("\n      W\n      "),r("div",{staticClass:"value-label"},[e._v(e._s(e.label))])]),e._v(" "),r("div",{staticClass:"soc-area",style:e.socStyle},[r("div",{staticClass:"track tiny-horizontal"},[r("div",{staticClass:"bar",style:e.socBarStyle})]),e._v("\n      "+e._s(e.soc)+" %\n    ")])]),e._v(" "),r("div",{staticClass:"frame"})])}),[],!1,null,null,null).exports,C=(r(223),{provide:function(){var e=this;return{limits:this.limits,setUpperLimit:function(t,r){void 0!==r&&(e.upperLimitClientMap[t._uid]=r,e.refreshLimits())},setLowerLimit:function(t,r){void 0!==r&&(e.lowerLimitClientMap[t._uid]=r,e.refreshLimits())}}},data:function(){return{limits:{upper:0,lower:0,distance:0}}},created:function(){this.upperLimitClientMap={},this.lowerLimitClientMap={}},methods:{refreshLimits:function(){this.limits.upper=Object.values(this.upperLimitClientMap).reduce((function(a,b){return Math.max(a,b)}),0),this.limits.lower=Object.values(this.lowerLimitClientMap).reduce((function(a,b){return Math.min(a,b)}),0),this.limits.distance=this.limits.upper-this.limits.lower}}}),_=(r(224),{components:{BarChart:Object(w.a)(C,(function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"chart-area"},[this._t("default")],2)}),[],!1,null,null,null).exports,BarGauge:k},mixins:[x(window.location.hostname,9001)],data:function(){return{actions:[{name:"stop",id:3},{name:"standby",id:4},{name:"chargeImmediate",id:0},{name:"minPlusPv",id:1},{name:"onlyPv",id:2}],lastError:null,staticData:{},mqttData:this.$mqttRegisterSubscriptions({selectedChargeModeId:x.Number("openWB/global/ChargeMode",-1),houseConsumption:"openWB/global/WHouseConsumption",evu:{W:"openWB/evu/W"},pv:{W:"openWB/pv/W"},houseBattery:{W:"openWB/housebattery/W",soc:"openWB/housebattery/%Soc"},chargers:[{W:"openWB/lp/1/W",soc:"openWB/lp/1/%Soc",enabled:x.Boolean("openWB/lp/1/ChargePointEnabled")},{W:"openWB/lp/2/W",soc:"openWB/lp/2/%Soc",enabled:x.Boolean("openWB/lp/2/ChargePointEnabled")}]},x.Number)}},computed:{},watch:{lastError:function(e){e&&console.error(e)}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshAllData();case 2:setInterval(Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshAllData();case 2:case"end":return t.stop()}}),t)}))),36e5);case 3:case"end":return t.stop()}}),t)})))()},methods:{clickAction:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$mqttSendMessage("openWB/set/ChargeMode",e.id);case 2:case"end":return r.stop()}}),r)})))()},refreshAllData:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.lastError=null,t.next=4,e.$axios.$get("api/staticData.php");case 4:e.staticData=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.lastError=t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},enableCharger:function(e,t){var r=this;return Object(o.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.$mqttSendMessage("openWB/set/".concat(e,"/ChargePointEnabled"),t?"1":"0");case 2:case"end":return o.stop()}}),o)})))()}}}),B=(r(226),Object(w.a)(_,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",class:{error:!!e.lastError}},[r("bar-chart",[r("bar-gauge",{attrs:{name:e.$t("bars.evu"),value:e.mqttData.evu.W,positivLabel:e.$t("bars.drawFromGrid"),negativLabel:e.$t("bars.feedToGrid"),"min-value":-e.staticData.displayevumax,"max-value":e.staticData.displayevumax,ranges:{green:100,purple:-100}}}),e._v(" "),r("bar-gauge",{attrs:{name:e.$t("bars.pv"),value:-e.mqttData.pv.W,"min-value":0,"max-value":e.staticData.displaypvmax,ranges:{green:100}}}),e._v(" "),r("bar-gauge",{attrs:{name:e.$t("bars.houseBattery"),value:-e.mqttData.houseBattery.W,positivLabel:e.$t("bars.dischargeBattery"),negativLabel:e.$t("bars.chargeBattery"),"min-value":-e.staticData.displayspeichermax,"max-value":e.staticData.displayspeichermax,ranges:{green:100,purple:-100},showSoc:"",soc:e.mqttData.houseBattery.soc}}),e._v(" "),r("bar-gauge",{attrs:{name:e.$t("bars.houseConsumption"),value:-e.mqttData.houseConsumption,"min-value":-e.staticData.displayhausmax,"max-value":0,ranges:{purple:-100}}}),e._v(" "),r("bar-gauge",{attrs:{name:e.staticData.lp1name,value:-e.mqttData.chargers[0].W,selectable:"",selected:e.mqttData.chargers[0].enabled,positivLabel:e.$t("bars.chargeBattery"),zeroLabel:e.$t("bars.activated"),labelOverride:e.mqttData.chargers[0].enabled?"":e.$t("bars.deactivated"),"min-value":-e.staticData.displaylp1max,"max-value":0,ranges:{purple:-100},showSoc:"",soc:e.mqttData.chargers[0].soc},on:{click:function(t){return e.enableCharger("lp1",!e.mqttData.chargers[0].enabled)}}}),e._v(" "),e.staticData.lastmanagement?r("bar-gauge",{attrs:{name:e.staticData.lp2name,value:-e.mqttData.chargers[1].W,selectable:"",selected:e.mqttData.chargers[1].enabled,positivLabel:e.$t("bars.chargeBattery"),zeroLabel:e.$t("bars.activated"),labelOverride:e.mqttData.chargers[1].enabled?"":e.$t("bars.deactivated"),"min-value":-e.staticData.displaylp2max,"max-value":0,ranges:{purple:100},showSoc:"",soc:e.mqttData.chargers[1].soc},on:{click:function(t){return e.enableCharger("lp2",!e.mqttData.chargers[1].enabled)}}}):e._e()],1),e._v(" "),r("div",{staticClass:"buttonbar"},e._l(e.actions,(function(t){return r("button",{key:t.id,class:{selected:t.id==e.mqttData.selectedChargeModeId},on:{click:function(r){return e.clickAction(t)}}},[e._v(e._s(e.$t("actions."+t.name)))])})),0)],1)}),[],!1,null,null,null));t.default=B.exports}}]);