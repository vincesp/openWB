(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{216:function(e,t,r){var content=r(225);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(82).default)("8da5bbd6",content,!0,{sourceMap:!1})},217:function(e,t,r){var content=r(227);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(82).default)("1ffe32f5",content,!0,{sourceMap:!1})},218:function(e,t,r){var content=r(229);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(82).default)("bfa9fc46",content,!0,{sourceMap:!1})},219:function(e,t,r){var content=r(231);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(82).default)("0ace817b",content,!0,{sourceMap:!1})},224:function(e,t,r){"use strict";var n=r(216);r.n(n).a},225:function(e,t,r){(t=r(81)(!1)).push([e.i,".value-area{text-align:center}.value-area .title{font-size:1.5rem;line-height:1em;margin:0 0 5px}.value-area .values{display:grid;grid-auto-flow:column;grid-auto-columns:auto;grid-gap:5px;gap:5px}",""]),e.exports=t},226:function(e,t,r){"use strict";var n=r(217);r.n(n).a},227:function(e,t,r){(t=r(81)(!1)).push([e.i,".color-green{color:#24db7c}.color-yellow{color:#ebe914}.color-red{color:#ff3500}.color-purple{color:#ff00f8}.color-white{color:#fff}.live-value{text-align:center}.big-value{display:inline-block;line-height:1em;position:relative}.big-value .space-measure{visibility:hidden}.big-value .display-value{position:absolute;right:0;top:0}.value-label{height:1.1em}",""]),e.exports=t},228:function(e,t,r){"use strict";var n=r(218);r.n(n).a},229:function(e,t,r){(t=r(81)(!1)).push([e.i,".toggle{display:inline-flex;justify-content:center;align-items:center;position:relative;padding:0 2.125rem;min-height:4.25rem;box-sizing:border-box}.toggle .toggle__indicator{position:absolute;bottom:.25rem;border:2px solid var(--color-accent);background-color:var(--color-accent-25);height:.5rem;width:2rem;border-radius:.25rem;box-sizing:border-box}.toggle.selected .toggle__indicator{border:1px solid var(--color-accent-p10);background-color:var(--color-accent)}",""]),e.exports=t},230:function(e,t,r){"use strict";var n=r(219);r.n(n).a},231:function(e,t,r){(t=r(81)(!1)).push([e.i,".container{position:fixed;display:grid;grid-template-columns:1fr;grid-template-rows:-webkit-max-content auto -webkit-max-content;grid-template-rows:max-content auto max-content;width:100%;height:100%;grid-gap:10px;gap:10px}.value-display{grid-auto-columns:auto}.charger-container,.value-display{display:grid;grid-auto-flow:column;grid-gap:10px;gap:10px}.charger-container{grid-template-rows:1fr;grid-auto-columns:1fr}.charger{display:grid;grid-auto-flow:column;grid-gap:10px;gap:10px;grid-template-columns:1fr 1fr;grid-auto-rows:auto;align-content:center}.span-row{grid-column:1/-1}.buttonbar{display:grid;grid-auto-flow:column;grid-auto-columns:1fr}.buttonbar>:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.buttonbar>:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}",""]),e.exports=t},233:function(e,t,r){"use strict";r.r(t);r(50),r(26),r(25),r(13),r(46),r(20);var n=r(4),o=r(23),l=r(17),c=(r(148),r(37)),d=(r(220),r(234)),v=r(223),f=r.n(v),m=r(1);function h(e,t){return{topic:e,defaultValue:t,transform:function(e){return e}}}function y(e,t){console.log("mqtt",e,t);var r=new f.a.Client(e,t,Object(d.a)()),n=[],o={};function v(e,t,r){if(t)if(Array.isArray(t))for(var i=0;i<t.length;++i)r(i,t[i]);else if("object"===Object(c.a)(t))for(var n=0,o=Object.entries(t);n<o.length;n++){var d=Object(l.a)(o[n],2);r(d[0],d[1])}}function y(e,data,t){v(0,e,(function(e,n){var l=n;switch(Object(c.a)(n)){case"string":l=t(n);case"function":var d=l(),v=d.topic,f=d.transform;!function(e,t){o[e]&&console.warn("Overriding topic",e),t?(o[e]=t,r.subscribe(e)):(delete o[e],r.unsubscribe(t))}(v,(function(t){return m.a.set(data,e,f(t))}));break;default:y(n,data[e],t)}}))}function x(e,t){v(0,t,(function(t,r){if("string"!=typeof r)if("function"!=typeof r)e[t]=e[t]||(Array.isArray(r)?[]:{}),x(e[t],r);else{var n=r().defaultValue;void 0!==n&&(e[t]=n)}}))}function _(){if(r.isConnected())for(;n.length;){var e=n.shift();y(e.subscriptionMap,e.data,e.defaultConfig)}}return r.onConnectionLost=function(e){console.error("MQTT connection lost",e)},r.onMessageArrived=function(e){console.log("in",e.destinationName,e.payloadString);try{o[e.destinationName](e.payloadString)}catch(e){console.log(e)}},r.connect({onSuccess:function(){console.log("MQTT connected"),_()}}),{methods:{$mqttRegisterSubscriptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,data={};return x(data,e),n.push({subscriptionMap:e,data:data,defaultConfig:t}),_(),data},$mqttSendMessage:function(e,t){var n=new f.a.Message("".concat(t));n.destinationName=e,console.log("out",e,t),r.send(n)}},destroyed:function(){r.disconnect()}}}y.String=h,y.Boolean=function(e,t){return function(){return{topic:e,defaultValue:t,transform:function(e){return!!Number(e)}}}},y.Number=function(e,t){return function(){return{topic:e,defaultValue:t,transform:function(e){return Number(e)}}}};var x=y,_={props:{title:String}},w=(r(224),r(47)),C=Object(w.a)(_,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"value-area"},[t("h1",{staticClass:"title"},[this._v(this._s(this.title))]),this._v(" "),t("div",{staticClass:"values"},[this._t("default")],2)])}),[],!1,null,null,null).exports,O={props:{value:Number,templateValue:{type:Number,default:99999},minValue:Number,maxValue:Number,unit:String,negativLabel:String,positivLabel:String,zeroLabel:String,labelOverride:String,ranges:Object},computed:{displayValue:function(){return Math.abs(this.value||0)},label:function(){return this.labelOverride||(this.value<0?this.negativLabel:this.value>0?this.positivLabel:this.zeroLabel||"")},valueColorName:function(){var e="";if(console.log(this.ranges),this.ranges)for(var t=0,r=Object.entries(this.ranges);t<r.length;t++){var n=Object(l.a)(r[t],2),o=n[0],c=n[1],d=this.percentToNumber(c);if(d*this.value>0&&(100==c&&Math.abs(this.value)>Math.abs(d)&&(d=this.value),Math.abs(this.value)<=Math.abs(d))){if(e&&Math.abs(this.ranges[e])<Math.abs(c))continue;e=o}}return e}},methods:{percentToNumber:function(e){return e<0?-e/100*this.minValue:e/100*this.maxValue}}},D=(r(226),Object(w.a)(O,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"live-value",class:"color-"+e.valueColorName},[r("div",{staticClass:"big-value large-font"},[r("i18n-n",{staticClass:"space-measure",attrs:{value:e.templateValue},scopedSlots:e._u([{key:"group",fn:function(){return[e._v(" ")]},proxy:!0}])}),e._v(" "),r("i18n-n",{staticClass:"display-value",attrs:{value:e.displayValue},scopedSlots:e._u([{key:"group",fn:function(){return[e._v(" ")]},proxy:!0}])})],1),e._v("\n  "+e._s(e.unit)+"\n  "),e.label?r("div",{staticClass:"value-label"},[e._v(e._s(e.label))]):e._e()])}),[],!1,null,null,null).exports),W={props:{value:Boolean,enabled:{type:Boolean,default:!0}},methods:{onClick:function(){this.enabled&&this.$emit("input",!this.value)}}};r(228);function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function M(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var B={components:{ValueArea:C,LiveValue:D,Toggle:Object(w.a)(W,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"toggle",class:{selected:e.value,toucharea:e.enabled,toucharea__item:e.enabled},on:{click:e.onClick}},[r("div",[e._t("default")],2),e._v(" "),e.enabled?r("div",{staticClass:"toggle__indicator"}):e._e()])}),[],!1,null,null,null).exports},mixins:[x(window.location.hostname,9001)],data:function(){return{foo:!0,actions:[{name:"chargeImmediate",id:0},{name:"pv1",id:1},{name:"pv2",id:2,prio:"car"},{name:"pv3",id:2,prio:"homeBattery"},{name:"standby",id:4},{name:"stop",id:3}],lastError:null,staticData:{},mqttData:this.$mqttRegisterSubscriptions({selectedChargeModeId:x.Number("openWB/global/ChargeMode",-1),houseConsumption:"openWB/global/WHouseConsumption",evu:{W:"openWB/evu/W"},pv:{W:"openWB/pv/W"},houseBattery:{W:"openWB/housebattery/W",soc:"openWB/housebattery/%Soc"},chargers:[{W:"openWB/lp/1/W",soc:"openWB/lp/1/%Soc",enabled:x.Boolean("openWB/lp/1/ChargePointEnabled")},{W:"openWB/lp/2/W",soc:"openWB/lp/2/%Soc",enabled:x.Boolean("openWB/lp/2/ChargePointEnabled")}]},x.Number)}},computed:{chargers:function(){for(var e=[],i=0;i<(this.staticData.lastmanagement?2:1);++i)e.push(M({id:"lp".concat(i+1),name:this.staticData["lp".concat(i+1,"name")]},this.mqttData.chargers[i]));return e},manualModeEnbled:function(){return 0==this.mqttData.selectedChargeModeId}},watch:{lastError:function(e){e&&console.error(e)}},mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshAllData();case 2:setInterval(Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshAllData();case 2:case"end":return t.stop()}}),t)}))),36e5);case 3:case"end":return t.stop()}}),t)})))()},methods:{clickAction:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$mqttSendMessage("openWB/set/ChargeMode",e.id);case 2:case"end":return r.stop()}}),r)})))()},refreshAllData:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.lastError=null,t.next=4,e.$axios.$get("api/staticData.php");case 4:e.staticData=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.lastError=t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},enableCharger:function(e,t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.$mqttSendMessage("openWB/set/".concat(e,"/ChargePointEnabled"),t?"1":"0");case 2:case"end":return n.stop()}}),n)})))()}}},$=(r(230),Object(w.a)(B,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container",class:{error:!!e.lastError}},[r("div",{staticClass:"value-display"},[r("value-area",{attrs:{title:e.$t("values.pv")}},[r("live-value",{attrs:{value:-e.mqttData.pv.W,unit:"W",templateValue:e.staticData.displaypvmax,labelOverride:e.$t("values.pvProduction"),"min-value":0,"max-value":e.staticData.displaypvmax,ranges:{green:100,yellow:10}}})],1),e._v(" "),r("value-area",{attrs:{title:e.$t("values.houseConsumption")}},[r("live-value",{attrs:{value:e.mqttData.houseConsumption,unit:"W",templateValue:e.staticData.displayhausmax,labelOverride:e.$t("values.consumption"),"min-value":0,"max-value":e.staticData.displayhausmax}})],1),e._v(" "),r("value-area",{attrs:{title:e.$t("values.evu")}},[r("live-value",{attrs:{value:e.mqttData.evu.W,unit:"W",templateValue:e.staticData.displayevumax,positivLabel:e.$t("values.drawFromGrid"),negativLabel:e.$t("values.feedToGrid"),"min-value":-e.staticData.displayevumax,"max-value":e.staticData.displayevumax,ranges:{green:-100,yellow:40,red:100}}})],1),e._v(" "),r("value-area",{attrs:{title:e.$t("values.houseBattery")}},[r("live-value",{attrs:{value:e.mqttData.houseBattery.W,unit:"W",templateValue:e.staticData.displayspeichermax,positivLabel:e.$t("values.chargeBattery"),zeroLabel:e.$t("values.chargeBattery"),negativLabel:e.$t("values.dischargeBattery"),"min-value":-e.staticData.displayspeichermax,"max-value":e.staticData.displayspeichermax,ranges:{green:100,yellow:-10,red:-100}}}),e._v(" "),r("live-value",{attrs:{value:e.mqttData.houseBattery.soc,unit:"%",templateValue:100,labelOverride:e.$t("values.soc"),"min-value":0,"max-value":100,ranges:{green:100,yellow:10}}})],1)],1),e._v(" "),r("div",{staticClass:"charger-container"},e._l(e.chargers,(function(t){return r("div",{key:t.id,staticClass:"charger"},[r("toggle",{staticClass:"span-row",attrs:{value:t.enabled},on:{input:function(r){return e.enableCharger(t.id,r)}}},[r("span",{staticClass:"large-font"},[e._v(e._s(t.name))])]),e._v(" "),r("toggle",{staticClass:"span-row",attrs:{enabled:e.manualModeEnbled}},[e._v(e._s(t.soc)+" %")])],1)})),0),e._v(" "),r("div",{staticClass:"buttonbar toucharea"},e._l(e.actions,(function(t){return r("button",{key:t.name,class:{selected:t.id==e.mqttData.selectedChargeModeId,toucharea__item:t.id!=e.mqttData.selectedChargeModeId},on:{click:function(r){return e.clickAction(t)}}},[e._v("\n      "+e._s(e.$t("actions."+t.name+".label"))+"\n      "),r("div",{staticClass:"small"},[e._v(e._s(e.$t("actions."+t.name+".description")))])])})),0)])}),[],!1,null,null,null));t.default=$.exports}}]);